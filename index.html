<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,300,0,0&icon_names=search"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />

    <title>Document</title>
    <link rel="stylesheet" href="zxcstream_final.css" />
    <style>
      * {
        /* border: 1px solid red; */
      }
      .aesthetic {
        z-index: -1;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 100%;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40'%3E%3Ccircle cx='20' cy='20' r='1.5' fill='white' /%3E%3C/svg%3E");
        background-repeat: repeat;
        background-size: 20px 20px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        overflow: hidden;
        background-color: #0d0d0d;
        pointer-events: none;
      }
      .aesthetic::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle,
          rgba(20, 20, 20, 0) 0%,
          rgba(0, 0, 0, 1) 79%
        );
        pointer-events: none;
      }
    </style>
  </head>

  <body
    style="
      min-height: 100vh;
      width: 100%;
      display: flex;
      align-items: center;
      flex-direction: column;
      gap: 100px;
    "
  >
    <div class="aesthetic"></div>
    <header>
      <div class="brandLogoContainer">
        <img
          style="filter: drop-shadow(0 0 1px rgb(33, 33, 33))"
          src="https://i.ibb.co/n0c3gXW/1.png"
        />
        <h1>[STREAM]</h1>
      </div>

      <nav>
        <div class="home">
          <div class="sidebar-logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-home"
            >
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
          </div>
          <p>Home</p>
        </div>
        <a href="/movie.html" class="movies">
          <div class="sidebar-logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-clapperboard"
            >
              <path
                d="M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z"
              ></path>
              <path d="m6.2 5.3 3.1 3.9"></path>
              <path d="m12.4 3.4 3.1 4"></path>
              <path d="M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"></path>
            </svg>
          </div>
          <p>Movies</p>
        </a>
        <a href="/tv.html" class="tvSeries">
          <div class="sidebar-logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-tv"
            >
              <rect width="20" height="15" x="2" y="7" rx="2" ry="2"></rect>
              <polyline points="17 2 12 7 7 2"></polyline>
            </svg>
          </div>
          <p>Series</p>
        </a>
        <a href="/search.html" class="searchFunction">
          <div class="sidebar-logo">
            <svg
              style="color: crimson"
              stroke="currentColor"
              fill="currentColor"
              stroke-width="0"
              viewBox="0 0 24 24"
              class="style_inactive__EPRfk"
              width="20"
              height="20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11 2C15.968 2 20 6.032 20 11C20 15.968 15.968 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2ZM11 18C14.8675 18 18 14.8675 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18ZM19.4853 18.0711L22.3137 20.8995L20.8995 22.3137L18.0711 19.4853L19.4853 18.0711Z"
              ></path>
            </svg>
          </div>
          <p>Search</p>
        </a>
      </nav>
    </header>

    <style>
      .typing {
        padding: 0 10px;
        text-align: center;
        white-space: nowrap;
        color: #e8e8e8;
        font-size: clamp(1rem, 0.9781rem + 1.0959vw, 1.8rem);
        overflow: hidden;
        font-weight: 500;
        border-right: 2px solid #fff;
        animation: typing 2s steps(30, end), blink 1s step-end infinite;
      }
      @keyframes typing {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }
      @keyframes blink {
        50% {
          border-color: transparent;
        }
      }
      .inputContainer {
        position: relative;
        width: 40%;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        flex-direction: column;
        height: 350px;
        gap: 50px;
      }
      #searchInput {
        width: 100%;
        padding: 15px 50px;
        border-radius: 25px;
        border: 0;
        outline: none;
      }
      .search-movie-card {
        width: 180px;
        height: 240px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        opacity: 0;
        transform: translateY(20px);
        filter: blur(5px);
        transition: all 0.5s ease-out;
        border-radius: 10px;
        overflow: hidden;
      }
      .search-movie-card.show {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
      }
      .search-movie-card:hover img {
        transform: scale(1.1);
      }
      .search-movie-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        transition: 0.5s;
      }

      #search-results-container {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        width: 90%;
        padding: 10px;
        height: 100%;
        justify-content: center;
      }
      @media only screen and (max-width: 768px) {
        .inputContainer {
          width: 90%;
        }
        #search-results-container {
          width: 100%;
        }
        .search-movie-card {
          width: 140px;
          height: 200px;
          border-radius: 8px;
        }
      }
    </style>

    <div class="inputContainer">
      <h1 class="typing">What would you like to watch tonight?</h1>
      <div
        style="
          position: relative;
          width: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
        "
      >
        <span
          style="position: absolute; left: 15px"
          class="material-symbols-rounded"
        >
          search
        </span>
        <input
          type="text"
          id="searchInput"
          placeholder="What do you want to watch?"
        />
      </div>
    </div>

    <div id="search-results-container"></div>
    <div id="search-no-results">No results found.</div>
  </body>
  <script>
    const apiKey = "47a1a7df542d3d483227f758a7317dff";
    const searchInput = document.getElementById("searchInput");
    const resultsContainer = document.getElementById(
      "search-results-container"
    );
    const noResults = document.getElementById("search-no-results");

    let currentPage = 1; // Track current page
    let currentQuery = ""; // Track current query
    let isFetching = false; // Prevent multiple simultaneous fetches

    const searchFetchMovies = async (query, page = 1) => {
      const response = await fetch(
        `https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${query}&language=en-US&page=${page}`
      );
      const data = await response.json();
      return data.results.filter(
        (movie) => movie.poster_path && movie.vote_average > 0
      );
    };

    const searchDisplayMovies = (movies) => {
      if (movies.length === 0 && currentPage === 1) {
        noResults.style.display = "block";
        return;
      } else {
        noResults.style.display = "none";
      }

      movies.forEach((movie, index) => {
        const movieCard = document.createElement("div");
        movieCard.classList.add("search-movie-card");
        const movieImageBackdrop = `https://image.tmdb.org/t/p/w1280${movie.backdrop_path}`;
        const movieImage = `https://image.tmdb.org/t/p/w1280${movie.poster_path}`;
        movieCard.innerHTML = `
          <img src="${movieImage}" alt="${movie.title || movie.name}" />
        `;

        resultsContainer.appendChild(movieCard);

        movieCard.addEventListener("click", () => {
          modal(
            movie.id,
            movie.overview,
            movieImageBackdrop,
            movieImage,
            movie.name || movie.title,
            movie.media_type,
            movie.vote_average,
            movie.release_date || movie.first_air_date,
            movie.original_language
          );
        });

        setTimeout(() => {
          movieCard.classList.add("show");
        }, index * 100);
      });
    };

    const loadMoreMovies = async () => {
      if (!currentQuery || isFetching) return;

      isFetching = true;
      currentPage++;
      const movies = await searchFetchMovies(currentQuery, currentPage);
      searchDisplayMovies(movies);
      isFetching = false;
    };

    const handleScroll = () => {
      const { scrollTop, scrollHeight, clientHeight } =
        document.documentElement;
      if (scrollTop + clientHeight >= scrollHeight - 10) {
        loadMoreMovies();
      }
    };

    searchInput.addEventListener("input", async (event) => {
      currentQuery = event.target.value;
      currentPage = 1;
      resultsContainer.innerHTML = "";

      if (currentQuery.length >= 1) {
        const movies = await searchFetchMovies(currentQuery, currentPage);
        searchDisplayMovies(movies);
      } else {
        noResults.style.display = "none";
      }
    });

    window.addEventListener("scroll", handleScroll);
  </script>
</html>
